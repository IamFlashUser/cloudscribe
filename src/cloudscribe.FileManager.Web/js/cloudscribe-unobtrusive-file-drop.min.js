document.addEventListener("DOMContentLoaded", function () { var e = document.querySelectorAll("[data-dropzone]"); window.cloudscribeDropAndCrop = { openServerBrowser: function (e) { $("#fileBrowseDialog").find("iframe").attr("src", e), $("#fileBrowseDialog").modal("show") }, closeServerBrowser: function () { $("#fileBrowseDialog").modal("hide") }, imageItems: [], buildImageEditor: function (e) { var t = { dropZoneDiv: e, setupCropper: function () { this.dropZoneDiv.dataset.resizeWidth, this.dropZoneDiv.dataset.resizeHeight; var e = new Number(this.dropZoneDiv.dataset.cropAreaWidth), t = new Number(this.dropZoneDiv.dataset.cropAreaHeight); this.cropper = new Croppie(this.fullSizeImage, { viewport: { width: e, height: t }, boundary: { width: e, height: t } }); var i = document.getElementById(this.dropZoneDiv.id + "-save-crop"); if (i) { var a = this; i.classList.remove("collapse"), i.onclick = function () { if (a.cropper) { var e = a.cropper.get(), t = new Number(e.points[0]), i = new Number(e.points[1]), s = new Number(e.points[2]), r = new Number(e.points[3]), d = s - t, o = r - i, n = new Number(a.dropZoneDiv.dataset.resizeWidth), l = new FormData; l.append("sourceFilePath", a.fullSizeInput.value), l.append("x1", t), l.append("y1", i), l.append("widthToCrop", d), l.append("heightToCrop", o), l.append("finalWidth", a.dropZoneDiv.dataset.resizeWidth), l.append("finalHeight", Math.round(n / (d / o))), $.ajax({ type: "POST", processData: !1, contentType: !1, headers: { "X-CSRFToken": a.dropZoneDiv.dataset.antiForgeryToken }, dataType: "json", url: a.dropZoneDiv.dataset.fileCropUrl, data: l }).done(function (e, t, i) { a.handleCropResult(e) }).fail(function (e, t, i) { alert(t) }) } } } }, destroyCropper: function () { if (this.cropper) { this.cropper.destroy(), this.cropper = void 0; var e = document.getElementById(this.dropZoneDiv.id + "-save-crop"); e && e.classList.add("collapse") } }, clearInputs: function () { this.dropZoneDiv.dataset.targetFullsizeInputId && (this.fullSizeInput = document.getElementById(this.dropZoneDiv.dataset.targetFullsizeInputId), this.fullSizeInput.value = ""), this.dropZoneDiv.dataset.targetResizedInputId && (this.resizedInput = document.getElementById(this.dropZoneDiv.dataset.targetResizedInputId), this.resizedInput.value = ""), this.dropZoneDiv.dataset.targetThumbInputId && (this.thumbInput = document.getElementById(this.dropZoneDiv.dataset.targetThumbInputId), this.thumbInput.value = "") }, clearImages: function () { if (this.destroyCropper(), this.dropZoneDiv.dataset.targetFullsizeImageId && this.dropZoneDiv.dataset.fullsizePlaceholderImage) { var e = document.getElementById(this.dropZoneDiv.dataset.targetFullsizeImageId); e.src = this.dropZoneDiv.dataset.fullsizePlaceholderImage } if (this.dropZoneDiv.dataset.targetResizedImageId && this.dropZoneDiv.dataset.resizedPlaceholderImage) { var e = document.getElementById(this.dropZoneDiv.dataset.targetResizedImageId); e.src = this.dropZoneDiv.dataset.resizedPlaceholderImage } if (this.dropZoneDiv.dataset.targetThumbImageId && this.dropZoneDiv.dataset.thumbPlaceholderImage) { var e = document.getElementById(this.dropZoneDiv.dataset.targetThumbImageId); e.src = this.dropZoneDiv.dataset.thumbPlaceholderImage } }, handleCropResult: function (e) { this.destroyCropper(), this.fullSizeImage.src = e.resizedUrl, this.resizedInput ? this.resizedInput.value = e.resizedUrl : this.fullSizeImage && (this.fullSizeImage.value = e.resizedUrl), window.HandleCropResult && window.HandleCropResult(e.resizedUrl) }, serverFileSelected: function (e) { this.destroyCropper(), this.clearInputs(), this.dropZoneDiv.dataset.targetFullsizeImageId && (this.fullSizeImage = document.getElementById(this.dropZoneDiv.dataset.targetFullsizeImageId), this.fullSizeImage.src = e), this.dropZoneDiv.dataset.targetResizedImageId && (this.resizedImage = document.getElementById(this.dropZoneDiv.dataset.targetResizedImageId), this.resizedImage.src = e), this.dropZoneDiv.dataset.targetFullsizeInputId && (this.fullSizeInput = document.getElementById(this.dropZoneDiv.dataset.targetFullsizeInputId), this.fullSizeInput.value = e), this.dropZoneDiv.dataset.targetResizedInputId && (this.resizedInput = document.getElementById(this.dropZoneDiv.dataset.targetResizedInputId), this.resizedInput.value = e), window.ServerFileSelected && window.ServerFileSelected(e), cloudscribeDropAndCrop.closeServerBrowser(), "true" == this.dropZoneDiv.dataset.enableCrop && this.setupCropper() }, dropZoneAddedFile: function (e) { this.cropper && this.destroyCropper() }, dropZoneSending: function (t, i, a) { this.dropZoneDiv.dataset.resizeWidth && this.dropZoneDiv.dataset.resizeHeight && (a.append("maxWidth", this.dropZoneDiv.dataset.resizeWidth), a.append("maxHeight", this.dropZoneDiv.dataset.resizeHeight)), "false" == this.dropZoneDiv.dataset.resizeImage && a.append("resizeImage", !1), this.dropZoneDiv.dataset.targetPath && a.append("targetPath", this.dropZoneDiv.dataset.targetPath), "true" == e.dataset.createThumb && a.append("createThumbnail", this.dropZoneDiv.dataset.createThumb), "true" == this.dropZoneDiv.dataset.keepOriginal && a.append("keepOriginal", !0), "false" == this.dropZoneDiv.dataset.keepOriginal && a.append("keepOriginal", !1) }, dropZoneSuccess: function (e, t) { this.dropZone && this.dropZone.removeFile(e); var i = t[0].originalUrl || t[0].resizedUrl, a = t[0].resizedUrl || t[0].originalUrl, s = t[0].thumbUrl; this.resizedImage = this.dropZoneDiv.getElementsByTagName("img")[0], this.resizedImage ? this.resizedImage.src = a : this.dropZoneDiv.dataset.targetResizedImageId && (this.resizedImage = document.getElementById(this.dropZoneDiv.dataset.targetResizedImageId), this.resizedImage && (this.resizedImage.src = a)), this.dropZoneDiv.dataset.targetThumbImageId && (this.thumbImage = document.getElementById(this.dropZoneDiv.dataset.targetThumbImageId), this.thumbImage && (this.thumbImage.src = s)), this.dropZoneDiv.dataset.targetFullsizeImageId && (this.fullSizeImage = document.getElementById(this.dropZoneDiv.dataset.targetFullsizeImageId), this.fullSizeImage && (this.fullSizeImage.src = i, "true" == this.dropZoneDiv.dataset.enableCrop && this.setupCropper())), this.dropZoneDiv.dataset.targetFullsizeInputId && (this.fullSizeInput = document.getElementById(this.dropZoneDiv.dataset.targetFullsizeInputId), this.fullSizeInput && (this.fullSizeInput.value = i)), this.dropZoneDiv.dataset.targetResizedInputId && (this.resizedInput = document.getElementById(this.dropZoneDiv.dataset.targetResizedInputId), this.resizedInput && (this.resizedInput.value = a)), this.dropZoneDiv.dataset.targetThumbInputId && (this.thumbInput = document.getElementById(this.dropZoneDiv.dataset.targetThumbInputId), this.thumbInput && (this.thumbInput.value = s)) }, dropZoneError: function (e, t) { console.log(t) } }; if (t.dropZone = this._buildDropZone(t, t.dropZoneDiv), e.dataset.fileBrowseUrl && "true" == e.dataset.enableBrowseServer) { var i = document.getElementById(e.id + "-browse-server"); i && (i.classList.remove("collapse"), i.onclick = function () { cloudscribeDropAndCrop.openServerBrowser(e.dataset.fileBrowseUrl), window.FileSelectCallback = function (e) { t.serverFileSelected(e) } }) } return cloudscribeDropAndCrop.imageItems.push(t), t }, clearOneZoneItems: function (e) { for (t = 0; t < this.imageItems.length; t++)this.imageItems[t].dropZoneDiv.id == e && (this.imageItems[t].clearInputs(), this.imageItems[t].clearImages()) }, clearAllItems: function () { for (t = 0; t < this.imageItems.length; t++)this.imageItems[t].clearInputs(), this.imageItems[t].clearImages() }, _buildDropZone: function (e, t) { var i = new Dropzone("#" + t.id, { url: t.dataset.uploadUrl, method: "post", headers: { "X-CSRFToken": t.dataset.antiForgeryToken }, maxFiles: 1, acceptedFiles: t.dataset.acceptedFiles, previewTemplate: '<div class="dz-preview dz-file-preview"><div class="dz-image"><img data-dz-thumbnail /></div><div class="dz-details collapse"><div class="dz-size collapse"><span data-dz-size></span></div><div class="dz-filename collapse"><span data-dz-name></span></div></div><div class="dz-progress collapse"><span class="dz-upload" data-dz-uploadprogress></span></div><div class="dz-error-message collapse"><span data-dz-errormessage></span></div><div class="dz-success-mark collapse"></div><div class="dz-error-mark collapse"></div></div>', createImageThumbnails: !1, clickable: !0 }); return i.on("addedfile", function (t) { e.dropZoneAddedFile && e.dropZoneAddedFile(t), window.DropZoneAddedFileHandler && window.DropZoneAddedFileHandler(t) }), i.on("sending", function (t, i, a) { e.dropZoneSending && e.dropZoneSending(t, i, a), window.DropZoneSendingHandler && window.DropZoneSendingHandler(t, i, a) }), i.on("success", function (t, i) { e.dropZoneSuccess && e.dropZoneSuccess(t, i, e), window.DropZoneSuccessHandler && window.DropZoneSuccessHandler(t, i, e) }), i.on("error", function (t, i) { e.dropZoneError && e.dropZoneError(t, i), window.DropZoneErrorHandler && window.DropZoneErrorHandler(t, i) }), i } }; for (var t = 0; t < e.length; t++) { var i = e[t]; cloudscribeDropAndCrop.buildImageEditor(i) } var a = document.getElementById("dz1-clear-image"); a && (a.onclick = function e() { var t = document.getElementById("imgUrlFull"); t && (t.value = ""); var i = document.getElementById("dz1Image"); let a = document.getElementById("imgUrlResized"), s = document.getElementsByClassName("cr-image"); if (i) { i.src = "/cr/images/690x517-placeholder.png", a.src = "", a.value = ""; for (let r = 0; r < s.length; r++)s[r].src = "/cr/images/690x517-placeholder.png" } }) });