!function(){var fileManager={headers:{"X-CSRFToken":$("#fmconfig").data("anti-forgery-token")},treeDataApiUrl:$("#fmconfig").data("filetree-url"),allowedFiles:$("#fmconfig").data("allowed-file-extensions"),uploadApiUrl:$("#fmconfig").data("upload-url"),downloadFileApiUrl:$("#fmconfig").data("file-download-url"),createFolderApiUrl:$("#fmconfig").data("create-folder-url"),deleteFolderApiUrl:$("#fmconfig").data("delete-folder-url"),renameFolderApiUrl:$("#fmconfig").data("rename-folder-url"),deleteFileApiUrl:$("#fmconfig").data("delete-file-url"),renameFileApiUrl:$("#fmconfig").data("rename-file-url"),canDelete:$("#fmconfig").data("can-delete"),canSelect:$("#fmconfig").data("can-select"),canDownload:$("#fmconfig").data("can-download"),emptyPreviewUrl:$("#fmconfig").data("empty-preview-url"),rootVirtualPath:$("#fmconfig").data("root-virtual-path"),rootButton:$("#btnRoot"),fileSelectorButton:$("#btnSelector"),fileSelectorButtonAlt:$("#btnSelectorAlt"),deleteFolderPromptButton:$("#btnDeleteFolderPrompt"),deleteFolderButton:$("#btnDeleteFolder"),renameFolderPromptButton:$("#btnRenameFolderPrompt"),renameFolderButton:$("#btnRenameFolder"),selectForCropButton:$("#btnSelectForCrop"),deleteFilePromptButton:$("#btnDeleteFilePrompt"),deleteFileButton:$("#btnDeleteFile"),renameFilePromptButton:$("#btnRenameFilePrompt"),renameFileButton:$("#btnRenameFile"),selectedFileInput:$("#fileSelection"),newFolderButton:$("#btnCreateFolder"),progressUI:$("#progress"),uploadTab:$("#tab2"),cropTab:$("#tab3"),treeData:[],selectedFileList:[],setCropImageFromServer:function(){var url=fileManager.selectedFileInput.val();$("#image").attr("src",url),$("#cropCurrentDirLabel").html(url.substring(0,url.lastIndexOf("/"))),$("#cropCurrentDir").val(url.substring(0,url.lastIndexOf("/")));var name=url.substring(url.lastIndexOf("/"));$("#croppedFileName").val(name),$("#origFileName").val(name),$("#lnkCrop")[0].click()},clearServerCropImage:function(){$("#image").attr("src",fileManager.emptyPreviewUrl),$("#croppedFileName").val(""),$("#origFileName").val("")},setPreview:function(node){switch(fileManager.clearPreview(),node.mediaType){case"audio":$("#divAudioPreview").show(),$("#audio-source").attr("src",node.virtualPath),$("#audio-source").attr("type",node.mimeType),fileManager.audioPlayer=new Plyr("#audio-player",{});break;case"video":$("#divVideoPreview").show(),$("#video-source").attr("src",node.virtualPath),$("#video-source").attr("type",node.mimeType),fileManager.videoPlayer=new Plyr("#video-player",{});break;case"image":$("#divPreview").show(),$("#filePreview").attr("src",node.virtualPath+"?"+performance.now())}fileManager.uploadTab.hide(),fileManager.selectForCropButton.show();var sizeWarning=document.getElementById("divFileSizeWarning"),sizeTest;if(sizeWarning.style.display="none",$("#divFileSize").removeClass("alert-danger"),Number.isInteger(node.size)){var sizeInBytes=new Number(node.size),sizeMb,sizeKb;if(sizeInBytes>1e6)sizeTest=sizeInBytes/1e6+" MB",$("#divFileSize").addClass("alert-danger"),"image"==node.mediaType&&(sizeWarning.style.display="block");else sizeTest=sizeInBytes/1e3+" KB"}$("#divFileSize").text(sizeTest)},clearPreview:function(){var sizeWarning;$("#filePreview").attr("src",fileManager.emptyPreviewUrl),$("#fileCropPreview").attr("src",fileManager.emptyPreviewUrl),$("#croppedFileName").val(""),fileManager.uploadTab.show(),fileManager.selectForCropButton.hide(),fileManager.clearServerCropImage(),fileManager.videoPlayer&&fileManager.videoPlayer.destroy(),fileManager.audioPlayer&&fileManager.audioPlayer.destroy(),$("#divVideoPreview").hide(),$("#video-source").attr("src",""),$("#video-source").attr("type",""),$("#divAudioPreview").hide(),$("#audio-source").attr("src",""),$("#audio-source").attr("type",""),$("#divFileSize").text(""),document.getElementById("divFileSizeWarning").style.display="none"},setCurrentDirectory:function(virtualPath){$("#newFolderCurrentDir").val(virtualPath),$("#hdnCurrentVirtualPath").val(virtualPath),$("#uploadCurrentDir").val(virtualPath),$("#cropCurrentDir").val(virtualPath),$("#cropCurrentDirLabel").html(virtualPath+"/"),$("#currentFolder").html(virtualPath),$("#folderToDelete").val(virtualPath),$("#folderToRename").val(virtualPath),fileManager.showFolderTools()},clearCurrentDirectory:function(){$("#newFolderCurrentDir").val(fileManager.rootVirtualPath),$("#hdnCurrentVirtualPath").val(fileManager.rootVirtualPath),$("#uploadCurrentDir").val(fileManager.rootVirtualPath),$("#currentFolder").html(fileManager.rootVirtualPath),$("#folderToDelete").val(""),$("#folderToRename").val(""),fileManager.hideFolderTools()},setCurrentFile:function(virtualPath,fileName){fileManager.selectedFileInput.val(virtualPath),$("#newFolderCurrentDir").val(virtualPath.substring(0,virtualPath.lastIndexOf("/"))),$("#fileToRename").val(virtualPath),$("#fileToDelete").val(virtualPath),fileName&&($("#newFileNameSegment").val(fileName),fileManager.downloadFileApiUrl&&fileManager.downloadFileApiUrl.length>0&&$("#lnkDownloadFile").attr("href",fileManager.downloadFileApiUrl+"?fileToDownload="+virtualPath)),fileManager.showFileTools()},clearCurrentFile:function(){fileManager.selectedFileInput.val(""),$("#fileToRename").val(""),$("#fileToDelete").val(""),$("#newFileNameSegment").val(""),fileManager.hideFileTools(),fileManager.clearPreview()},backToRoot:function(){fileManager.clearCurrentFile(),fileManager.clearCurrentDirectory(),fileManager.clearPreview(),fileManager.setCurrentDirectory(fileManager.rootVirtualPath),fileManager.loadTree()},showFolderTools:function(){var currentFolder;fileManager.canDelete&&($("#hdnCurrentVirtualPath").val()!=fileManager.rootVirtualPath&&($("#frmDeleteFolder").show(),$("#frmRenameFolder").show()));$("#frmNewFolder").show()},hideFolderTools:function(){$("#frmDeleteFolder").hide(),$("#frmRenameFolder").hide(),$("#frmNewFolder").hide()},showFileTools:function(){fileManager.canDelete&&($("#frmDeleteFile").show(),$("#frmRenameFile").show(),fileManager.downloadFileApiUrl&&$("#lnkDownloadFile").show())},hideFileTools:function(){$("#frmDeleteFile").hide(),$("#frmRenameFile").hide(),$("#lnkDownloadFile").hide()},notify:function(message,cssClass){$("#alert_placeholder").html('<div class="alert '+cssClass+'"><button type="button" data-bs-dismiss="alert" class="btn-close me-2" style="float:right" aria-label="Close"></button><span>'+message+"</span></div>")},addFileToList:function(data,fileList,index,file){var d=$("<span class='far fa-trash-alt' aria-role='button' title='Remove'></span>").click((function(){data.files.splice(index,1),fileList=data.files,$("#fileList li").eq(index).remove(),0===fileList.length&&$("#fileList").html("")})),item=$("<li>",{text:file.name}).append("&nbsp;").append(d);$("#fileList ul").append(item)},addErrorToList:function(index,file){var item=$("<li>",{text:file.ErrorMessage});$("#fileList ul").append(item)},createFolder:function(){var formData=$("#frmNewFolder").serializeArray();return $.ajax({method:"POST",url:fileManager.createFolderApiUrl,headers:fileManager.headers,data:formData}).done((function(data){var currentPath;data.succeeded?($("#newFolderCurrentDir").val()===fileManager.rootVirtualPath?fileManager.loadTree():fileManager.reloadSubTree(),$("#newFolderName").val("")):fileManager.notify(data.message,"alert-danger")})).fail((function(){fileManager.notify("An error occured","alert-danger")})),!1},deleteFolderPrompt:function(){var currentPath=$("#folderToDelete").val();if(currentPath===fileManager.rootVirtualPath)return!1;var message="Are you sure you want to permanently delete the folder "+currentPath+" and any files or folders below it?";return $("#deleteFolderModalBody").html(message),$("#mdlDeleteFolder").modal("show"),!1},deleteFolder:function(){$("#mdlDeleteFolder").modal("hide");var currentPath=$("#folderToDelete").val();if(currentPath===fileManager.rootVirtualPath)return!1;var formData=$("#frmDeleteFolder").serializeArray();return $.ajax({method:"POST",url:fileManager.deleteFolderApiUrl,headers:fileManager.headers,data:formData}).done((function(data){data.succeeded?(fileManager.removeNode(currentPath),fileManager.clearCurrentDirectory()):fileManager.notify(data.message,"alert-danger")})).fail((function(){fileManager.notify("An error occured","alert-danger")})),!1},renameFolderPrompt:function(){var currentPath=$("#folderToRename").val();if(currentPath===fileManager.rootVirtualPath)return!1;var message="Are you sure you want to rename the folder "+currentPath+"?";return $("#renameFolderModalBody").html(message),$("#mdlRenameFolder").modal("show"),!1},renameFolder:function(){$("#mdlRenameFolder").modal("hide");var currentPath=$("#folderToRename").val();if(currentPath===fileManager.rootVirtualPath)return!1;var formData=$("#frmRenameFolder").serializeArray();return $.ajax({method:"POST",url:fileManager.renameFolderApiUrl,headers:fileManager.headers,data:formData}).done((function(data){if(data.succeeded){var tree=$("#tree").treeview(!0),matchingNodes=tree.findNodes(currentPath,"id");if(matchingNodes){var parents=tree.getParents(matchingNodes);parents&&parents.length>0?fileManager.reloadSubTree(parents[0].id):fileManager.loadTree()}$("#newNameSegment").val(""),fileManager.clearCurrentDirectory()}else fileManager.notify(data.message,"alert-danger")})).fail((function(){fileManager.notify("An error occured","alert-danger")})),!1},deleteFilePrompt:function(){var currentPath=$("#fileToDelete").val();if(""===currentPath)return!1;var message="Are you sure you want to permanently delete the file "+currentPath+"?";return $("#deleteFileModalBody").html(message),$("#mdlDeleteFile").modal("show"),!1},deleteFile:function(){$("#mdlDeleteFile").modal("hide");var currentPath=$("#fileToDelete").val();if(""===currentPath)return!1;if(currentPath===fileManager.rootVirtualPath)return!1;var formData=$("#frmDeleteFile").serializeArray();return $.ajax({method:"POST",url:fileManager.deleteFileApiUrl,headers:fileManager.headers,data:formData}).done((function(data){data.succeeded?(fileManager.removeNode(currentPath),fileManager.clearCurrentFile()):fileManager.notify(data.message,"alert-danger")})).fail((function(){fileManager.notify("An error occured","alert-danger")})),!1},renameFilePrompt:function(){var currentPath=$("#fileToRename").val();if(""===currentPath)return!1;var message="Are you sure you want to rename the file "+currentPath+"?";return $("#renameFileModalBody").html(message),$("#mdlRenameFile").modal("show"),!1},renameFile:function(){$("#mdlRenameFile").modal("hide");var currentPath=$("#fileToRename").val();if(""===currentPath)return!1;if(currentPath===fileManager.rootVirtualPath)return!1;var formData=$("#frmRenameFile").serializeArray();return $.ajax({method:"POST",url:fileManager.renameFileApiUrl,headers:fileManager.headers,data:formData}).done((function(data){if(data.succeeded){var tree=$("#tree").treeview(!0),matchingNodes=tree.findNodes(currentPath,"id");if(matchingNodes){var parents=tree.getParents(matchingNodes);parents&&parents.length>0&&fileManager.reloadSubTree(parents[0].id)}fileManager.clearCurrentFile()}else fileManager.notify(data.message,"alert-danger")})).fail((function(){fileManager.notify("An error occured","alert-danger")})),!1},selectfile:function(){var funcNum=$("#fmconfig").data("ckfunc"),fileUrl=fileManager.selectedFileInput.val();0===fileUrl.length?fileManager.notify("Please select a file in the browse tab","alert-danger"):window.parent&&window.parent.FileSelectCallback?window.parent.FileSelectCallback(fileUrl):(window.opener.CKEDITOR.tools.callFunction(funcNum,fileUrl),window.close())},removeNode:function(id){var tree=$("#tree").treeview(!0),matchingNodes=tree.findNodes(id,"id");tree.removeNode(matchingNodes,{silent:!0})},reloadSubTree:function(folderIdToReload){var tree=$("#tree").treeview(!0),currentFolderId=folderIdToReload||$("#uploadCurrentDir").val();if(0!==currentFolderId.length&&currentFolderId!==fileManager.rootVirtualPath){var matchingNodes=tree.findNodes(currentFolderId,"id");if(matchingNodes.length>0){try{tree.collapseNode(matchingNodes,{silent:!0,ignoreChildren:!1})}catch(err){}var theNode=matchingNodes[0],newNode={text:theNode.text,id:theNode.id,type:theNode.type,icon:theNode.icon,expandedIcon:theNode.expandedIcon,virtualPath:theNode.virtualPath,nodes:[],lazyLoad:!0};try{tree.updateNode(theNode,newNode,{silent:!0}),matchingNodes=tree.findNodes(currentFolderId,"id"),tree.expandNode(matchingNodes,{silent:!0,ignoreChildren:!1})}catch(err){}}else alert("node not found")}else fileManager.loadTree()},loadTree:function(){$("#tree").treeview({dataUrl:{method:"GET",dataType:"json",url:fileManager.treeDataApiUrl,cache:!1},nodeIcon:"far fa-folder mr-1",collapseIcon:"fas fa-minus",emptyIcon:"fa",expandIcon:"fas fa-plus",loadingIcon:"far fa-hourglass",levels:2,onhoverColor:"#F5F5F5",highlightSelected:!0,showBorder:!0,showCheckbox:!1,showIcon:!0,wrapNodeText:!1,lazyLoad:function(node,dataFunc){$.ajax({dataType:"json",url:fileManager.treeDataApiUrl+"&virtualStartPath="+node.virtualPath}).done((function(data){dataFunc(data)})),node.lazyLoaded=!0},onNodeSelected:function(event,node){$("#divPreview").hide(),node.canPreview?fileManager.setPreview(node):fileManager.clearPreview(),"d"===node.type?(fileManager.setCurrentDirectory(node.virtualPath),fileManager.clearCurrentFile(),fileManager.hideFileTools()):(fileManager.hideFolderTools(),fileManager.setCurrentFile(node.virtualPath,node.text))},onNodeUnselected:function(event,node){node.lazyLoaded&&(node.lazyLoaded=!1),"d"===node.type?fileManager.hideFolderTools():fileManager.hideFileTools()}})},setupFileLoader:function(){$("#pnlFiles").fileupload({fileInput:$("#fileupload"),url:fileManager.uploadApiUrl,headers:fileManager.headers,dataType:"json",autoUpload:!0,singleFileUploads:!0,dropZone:$("#dropZone"),pasteZone:$("#dropZone"),add:function(e,data){$("#fileList").empty(),$("#fileList").append($("<ul class='filelist'></ul>"));for(var allowedFiles=fileManager.allowedFiles.split("|"),regx=new RegExp("([a-zA-Z0-9؀-ۿs_\\.-:])+("+allowedFiles.join("|")+")$"),j=0,k=data.files.length;j<k;)!1===regx.test(data.files[j].name.toLowerCase())&&(fileManager.notify(data.files[j].name+" not allowed","alert-danger"),data.files.splice(j,1),k=data.files.length,j=-1),j++;fileManager.selectedFileList=fileManager.selectedFileList.concat(data.files),data.files.length>0&&data.process().done((function(){data.submit()}))},done:function(e,data){data.files=[],fileManager.selectedFileList=[],$("#fileupload").val(null),$("#progress").hide(),$("#fileList").empty(),fileListuploader=[],$("#fileList").append($("<ul class='filelist file-errors'></ul>"));for(var j=0,errorsOccurred=!1;j<data.length;)data[j].errorMessage&&(errorsOccurred=!0,addErrorToList(j,data[j])),j++},progressall:function(e,data){var progress=parseInt(data.loaded/data.total*100,10);fileManager.progressUI.show(),$("#progress .progress-bar").css("width",progress+"%"),100===progress&&(fileManager.notify("File upload success.","alert-success"),setTimeout((function(){fileManager.reloadSubTree()}),3e3))},fail:function(e,data){$("#progress .progress-bar").css("width","0%"),fileManager.progressUI.hide(),fileManager.notify("Something went wrong, possibly the file is larger than allowed by server configuration.","alert-danger")}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled"),$("#fileupload").bind("fileuploadsubmit",(function(e,data){return data.formData=$("#frmUpload").serializeArray(),!0}))},init:function(){$(document).bind("drop dragover",(function(e){e.preventDefault()})),this.progressUI.hide(),this.loadTree(),this.setupFileLoader(),this.newFolderButton.on("click",fileManager.createFolder),this.fileSelectorButton.on("click",fileManager.selectfile),this.fileSelectorButtonAlt.on("click",fileManager.selectfile),this.deleteFolderPromptButton.on("click",fileManager.deleteFolderPrompt),this.deleteFolderButton.on("click",fileManager.deleteFolder),this.renameFolderPromptButton.on("click",fileManager.renameFolderPrompt),this.renameFolderButton.on("click",fileManager.renameFolder),this.deleteFilePromptButton.on("click",fileManager.deleteFilePrompt),this.deleteFileButton.on("click",fileManager.deleteFile),this.renameFilePromptButton.on("click",fileManager.renameFilePrompt),this.renameFileButton.on("click",fileManager.renameFile),this.selectForCropButton.on("click",fileManager.setCropImageFromServer),this.setCurrentDirectory(this.rootVirtualPath),this.rootButton.on("click",fileManager.backToRoot),"false"!==fileManager.canSelect&&!1!==fileManager.canSelect||(this.fileSelectorButton.hide(),this.fileSelectorButtonAlt.hide())}};fileManager.init();var cropManager={uploadUrl:$("#fmconfig").data("upload-url"),URL:window.URL||window.webkitURL,console:window.console||{log:function(){}},image:$("#image"),saveLocalButton:$("#btnSaveLocal"),uploadCropButton:$("#btnUploadCrop"),croppedFileName:$("#croppedFileName"),chkConstrainCrop:$("#chkContrainWidthOfCrop"),cropMaxWidthInput:$("#cropMaxWidth"),dataX:$("#dataX"),dataY:$("#dataY"),dataHeight:$("#dataHeight"),dataWidth:$("#dataWidth"),dataRotate:$("#dataRotate"),dataScaleX:$("#dataScaleX"),dataScaleY:$("#dataScaleY"),outputHeight:$("#dataNewHeight"),outputWidth:$("#dataNewWidth"),initialised:!1,setup:function(){var options={aspectRatio:16/9,preview:".img-preview",crop:function(e){cropManager.dataX.val(Math.round(e.x)),cropManager.dataY.val(Math.round(e.y));var height=Math.round(e.height),width=Math.round(e.width);cropManager.dataHeight.val(height),cropManager.dataWidth.val(width),cropManager.dataRotate.val(e.rotate),cropManager.dataScaleX.val(e.scaleX),cropManager.dataScaleY.val(e.scaleY);var maxWidth=Math.round(cropManager.cropMaxWidthInput.val()),currentSrc;if(cropManager.chkConstrainCrop.is(":checked")&&width>maxWidth){cropManager.outputWidth.val(maxWidth);var aspect=cropManager.getCropAspectRatio(),newHeight=parseInt(maxWidth/aspect);cropManager.outputHeight.val(newHeight),cropManager.setCroppedFileName(maxWidth,newHeight)}else cropManager.outputHeight.val(height),cropManager.outputWidth.val(width),cropManager.setCroppedFileName(Math.round(e.width),Math.round(e.height));$.isFunction(document.createElement("canvas").getContext)&&(cropManager.image.attr("src")===fileManager.emptyPreviewUrl?cropManager.uploadCropButton.prop("disabled",!0):cropManager.uploadCropButton.prop("disabled",!1))}},originalImageURL=cropManager.image.attr("src"),uploadedImageURL;$('[data-bs-toggle="tooltip"]').tooltip(),cropManager.image.on({ready:function(e){},cropstart:function(e){},cropmove:function(e){},cropend:function(e){},crop:function(e){},zoom:function(e){}}).cropper(options),$.isFunction(document.createElement("canvas").getContext)||cropManager.uploadCropButton.prop("disabled",!0),void 0===document.createElement("cropper").style.transition&&($('button[data-method="rotate"]').prop("disabled",!0),$('button[data-method="scale"]').prop("disabled",!0)),void 0===cropManager.saveLocalButton[0].download&&cropManager.saveLocalButton.addClass("disabled"),0==cropManager.initialised&&$(".docs-toggles").on("change","input",(function(){var $this=$(this),name=$this.attr("name"),type=$this.prop("type"),cropBoxData,canvasData;cropManager.image.data("cropper")&&("checkbox"===type?(options[name]=$this.prop("checked"),cropBoxData=cropManager.image.cropper("getCropBoxData"),canvasData=cropManager.image.cropper("getCanvasData"),options.ready=function(){cropManager.image.cropper("setCropBoxData",cropBoxData),cropManager.image.cropper("setCanvasData",canvasData)}):"radio"===type&&(options[name]=$this.val()),cropManager.image.cropper("destroy").cropper(options))})),$("#btnUploadCropped").on("click",cropManager.uploadCroppedImage),cropManager.outputWidth.on("blur",(function(){var aspect=cropManager.getCropAspectRatio(),newWidth=parseInt(cropManager.outputWidth.val()),currentHeight=parseInt(cropManager.outputHeight.val()),newHeight=parseInt(newWidth/aspect),dif;Math.abs(newHeight-currentHeight)>1&&(cropManager.outputHeight.val(newHeight),cropManager.setCroppedFileName(newWidth,newHeight))})),cropManager.outputHeight.on("blur",(function(){var aspect=cropManager.getCropAspectRatio(),newHeight=parseInt(cropManager.outputHeight.val()),currentWidth=parseInt(cropManager.outputWidth.val()),newWidth=parseInt(newHeight*aspect),dif;Math.abs(newWidth-currentWidth)>1&&(cropManager.outputWidth.val(newWidth),cropManager.setCroppedFileName(newWidth,newHeight))})),cropManager.chkConstrainCrop.change((function(){if($(this).is(":checked")){var maxWidth=Math.round(cropManager.cropMaxWidthInput.val()),currentWidth;if(parseInt(cropManager.dataWidth.val())>maxWidth){cropManager.outputWidth.val(maxWidth);var currentHeight=parseInt(cropManager.dataHeight.val()),aspect=cropManager.getCropAspectRatio(),newHeight=parseInt(maxWidth/aspect);cropManager.outputHeight.val(newHeight)}}else cropManager.outputHeight.val(cropManager.dataHeight.val()),cropManager.outputWidth.val(cropManager.dataWidth.val())})),$(".docs-buttons").on("click","[data-method]",(function(){var $this=$(this),data=$this.data(),$target,result;if(!$this.prop("disabled")&&!$this.hasClass("disabled")&&cropManager.image.data("cropper")&&data.method){if(void 0!==(data=$.extend({},data)).target&&($target=$(data.target),void 0===data.option))try{data.option=JSON.parse($target.val())}catch(e){console.log(e.message)}switch("rotate"===data.method&&cropManager.image.cropper("clear"),void 0===data.option&&"getCroppedCanvas"===data.method&&(data.option={width:cropManager.outputWidth.val(),height:cropManager.outputHeight.val()}),result=cropManager.image.cropper(data.method,data.option,data.secondOption),"rotate"===data.method&&cropManager.image.cropper("crop"),data.method){case"scaleX":case"scaleY":$(this).data("option",-data.option);break;case"getCroppedCanvas":result&&($("#getCroppedCanvasModal").modal().find(".modal-body").html(result),$("#getCroppedCanvasModal").modal("show"),cropManager.saveLocalButton.hasClass("disabled")||cropManager.saveLocalButton.attr("href",result.toDataURL("image/jpeg")));break;case"destroy":uploadedImageURL&&(URL.revokeObjectURL(uploadedImageURL),uploadedImageURL="",cropManager.image.attr("src",originalImageURL))}if($.isPlainObject(result)&&$target)try{$target.val(JSON.stringify(result))}catch(e){console.log(e.message)}}})),$(document.body).on("keydown",(function(e){if(cropManager.image.data("cropper")&&!(this.scrollTop>300))switch(e.which){case 37:e.preventDefault(),cropManager.image.cropper("move",-1,0);break;case 38:e.preventDefault(),cropManager.image.cropper("move",0,-1);break;case 39:e.preventDefault(),cropManager.image.cropper("move",1,0);break;case 40:e.preventDefault(),cropManager.image.cropper("move",0,1)}}));var $inputImage=$("#inputImage");cropManager.URL?$inputImage.change((function(){var files=this.files,file;cropManager.image.data("cropper")&&files&&files.length&&(file=files[0],/^image\/\w+$/.test(file.type)?(uploadedImageURL&&URL.revokeObjectURL(uploadedImageURL),uploadedImageURL=cropManager.URL.createObjectURL(file),$("#origFileName").val(file.name.toLowerCase()),cropManager.croppedFileName.val(file.name.toLowerCase()),cropManager.image.cropper("destroy").attr("src",uploadedImageURL).cropper(options),$inputImage.val("")):window.alert("Please choose an image file."))})):$inputImage.prop("disabled",!0).parent().addClass("disabled"),cropManager.initialised=!0},tearDown:function(){$("#image").data("cropper")&&$("#image").cropper("destroy")},setCroppedFileName:function(width,height){var origName=$("#origFileName").val(),nameWithoutExtension=origName.substring(0,origName.lastIndexOf(".")),ext=origName.substring(origName.lastIndexOf("."));cropManager.croppedFileName.val(nameWithoutExtension+"-"+width+"x"+height+ext),cropManager.saveLocalButton.attr("download",cropManager.croppedFileName.val())},getCropAspectRatio:function(){var cropbox=$("#image").cropper("getCropBoxData");return cropbox.width/cropbox.height},uploadCroppedImage:function(){var opts={width:cropManager.outputWidth.val(),height:cropManager.outputHeight.val()};return $("#image").cropper("getCroppedCanvas",opts).toBlob((function(blob){var formData=new FormData;formData.append(cropManager.croppedFileName.val(),blob);var otherData=$("#frmUploadCropped").serializeArray();$.each(otherData,(function(key,input){formData.append(input.name,input.value)})),$.ajax({method:"POST",url:fileManager.uploadApiUrl,headers:fileManager.headers,data:formData,processData:!1,contentType:!1}).done((function(data,textStatus,jqXHR){if(data[0].errorMessage)fileManager.notify(data[0].errorMessage,"alert-danger");else{var currentPath=$("#cropCurrentDir").val();currentPath===fileManager.rootVirtualPath?fileManager.loadTree():fileManager.reloadSubTree(currentPath),$("#getCroppedCanvasModal").modal("hide"),fileManager.notify("Cropped image upload succeeded","alert-success")}})).fail((function(jqXHR,textStatus,errorThrown){fileManager.notify(errorThrown,"alert-danger")}))})),!1}};$('a[data-bs-toggle="tab"]').on("shown.bs.tab",(function(e){var target;if("#tabCrop"===$(e.target).attr("href"))cropManager.setup();else{var related=$(e.relatedTarget).attr("href"),hash;if(related)"tabCrop"===related.replace(/^.*?(#|$)/,"")&&cropManager.tearDown()}}))}();